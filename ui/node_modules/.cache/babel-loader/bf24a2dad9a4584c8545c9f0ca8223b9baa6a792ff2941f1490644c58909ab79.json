{"ast":null,"code":"import{useEffect,useState}from'react';import{FormControl,Popover}from'@mui/material';import ReactJson from'flowise-react-json-view';import SelectVariable from'./SelectVariable';import{cloneDeep}from'lodash';import{getAvailableNodesForVariable}from'utils/genericHelper';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export const JsonEditorInput=_ref=>{let{value,onChange,inputParam,nodes,edges,nodeId,disabled=false,isDarkMode=false}=_ref;const[myValue,setMyValue]=useState(value?JSON.parse(value):{});const[availableNodesForVariable,setAvailableNodesForVariable]=useState([]);const[mouseUpKey,setMouseUpKey]=useState('');const[anchorEl,setAnchorEl]=useState(null);const openPopOver=Boolean(anchorEl);const handleClosePopOver=()=>{setAnchorEl(null);};const setNewVal=val=>{const newVal=cloneDeep(myValue);newVal[mouseUpKey]=val;onChange(JSON.stringify(newVal));setMyValue(params=>({...params,[mouseUpKey]:val}));};const onClipboardCopy=e=>{const src=e.src;if(Array.isArray(src)||typeof src==='object'){navigator.clipboard.writeText(JSON.stringify(src,null,'  '));}else{navigator.clipboard.writeText(src);}};useEffect(()=>{if(!disabled&&nodes&&edges&&nodeId&&inputParam){const nodesForVariable=inputParam!==null&&inputParam!==void 0&&inputParam.acceptVariable?getAvailableNodesForVariable(nodes,edges,nodeId,inputParam.id):[];setAvailableNodesForVariable(nodesForVariable);}},[disabled,inputParam,nodes,edges,nodeId]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(FormControl,{sx:{mt:1,width:'100%'},size:\"small\",children:[disabled&&/*#__PURE__*/_jsx(ReactJson,{theme:isDarkMode?'ocean':'rjv-default',style:{padding:10,borderRadius:10},src:myValue,name:null,enableClipboard:e=>onClipboardCopy(e),quotesOnKeys:false,displayDataTypes:false}),!disabled&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(ReactJson,{theme:isDarkMode?'ocean':'rjv-default',style:{padding:10,borderRadius:10},src:myValue,name:null,quotesOnKeys:false,displayDataTypes:false,enableClipboard:e=>onClipboardCopy(e),onMouseUp:event=>{if(inputParam!==null&&inputParam!==void 0&&inputParam.acceptVariable){setMouseUpKey(event.name);setAnchorEl(event.currentTarget);}},onEdit:edit=>{setMyValue(edit.updated_src);onChange(JSON.stringify(edit.updated_src));},onAdd:()=>{//console.log(add)\n},onDelete:deleteobj=>{setMyValue(deleteobj.updated_src);onChange(JSON.stringify(deleteobj.updated_src));}})},JSON.stringify(myValue))]}),(inputParam===null||inputParam===void 0?void 0:inputParam.acceptVariable)&&/*#__PURE__*/_jsx(Popover,{open:openPopOver,anchorEl:anchorEl,onClose:handleClosePopOver,anchorOrigin:{vertical:'bottom',horizontal:'left'},transformOrigin:{vertical:'top',horizontal:'left'},children:/*#__PURE__*/_jsx(SelectVariable,{disabled:disabled,availableNodesForVariable:availableNodesForVariable,onSelectAndReturnVal:val=>{setNewVal(val);handleClosePopOver();}})})]});};","map":{"version":3,"names":["useEffect","useState","FormControl","Popover","ReactJson","SelectVariable","cloneDeep","getAvailableNodesForVariable","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","JsonEditorInput","_ref","value","onChange","inputParam","nodes","edges","nodeId","disabled","isDarkMode","myValue","setMyValue","JSON","parse","availableNodesForVariable","setAvailableNodesForVariable","mouseUpKey","setMouseUpKey","anchorEl","setAnchorEl","openPopOver","Boolean","handleClosePopOver","setNewVal","val","newVal","stringify","params","onClipboardCopy","e","src","Array","isArray","navigator","clipboard","writeText","nodesForVariable","acceptVariable","id","children","sx","mt","width","size","theme","style","padding","borderRadius","name","enableClipboard","quotesOnKeys","displayDataTypes","onMouseUp","event","currentTarget","onEdit","edit","updated_src","onAdd","onDelete","deleteobj","open","onClose","anchorOrigin","vertical","horizontal","transformOrigin","onSelectAndReturnVal"],"sources":["D:/Flowise/packages/ui/src/ui-component/json/JsonEditor.js"],"sourcesContent":["import { useEffect, useState } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport { FormControl, Popover } from '@mui/material'\r\nimport ReactJson from 'flowise-react-json-view'\r\nimport SelectVariable from './SelectVariable'\r\nimport { cloneDeep } from 'lodash'\r\nimport { getAvailableNodesForVariable } from 'utils/genericHelper'\r\n\r\nexport const JsonEditorInput = ({ value, onChange, inputParam, nodes, edges, nodeId, disabled = false, isDarkMode = false }) => {\r\n    const [myValue, setMyValue] = useState(value ? JSON.parse(value) : {})\r\n    const [availableNodesForVariable, setAvailableNodesForVariable] = useState([])\r\n    const [mouseUpKey, setMouseUpKey] = useState('')\r\n\r\n    const [anchorEl, setAnchorEl] = useState(null)\r\n    const openPopOver = Boolean(anchorEl)\r\n\r\n    const handleClosePopOver = () => {\r\n        setAnchorEl(null)\r\n    }\r\n\r\n    const setNewVal = (val) => {\r\n        const newVal = cloneDeep(myValue)\r\n        newVal[mouseUpKey] = val\r\n        onChange(JSON.stringify(newVal))\r\n        setMyValue((params) => ({\r\n            ...params,\r\n            [mouseUpKey]: val\r\n        }))\r\n    }\r\n\r\n    const onClipboardCopy = (e) => {\r\n        const src = e.src\r\n        if (Array.isArray(src) || typeof src === 'object') {\r\n            navigator.clipboard.writeText(JSON.stringify(src, null, '  '))\r\n        } else {\r\n            navigator.clipboard.writeText(src)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!disabled && nodes && edges && nodeId && inputParam) {\r\n            const nodesForVariable = inputParam?.acceptVariable ? getAvailableNodesForVariable(nodes, edges, nodeId, inputParam.id) : []\r\n            setAvailableNodesForVariable(nodesForVariable)\r\n        }\r\n    }, [disabled, inputParam, nodes, edges, nodeId])\r\n\r\n    return (\r\n        <>\r\n            <FormControl sx={{ mt: 1, width: '100%' }} size='small'>\r\n                {disabled && (\r\n                    <ReactJson\r\n                        theme={isDarkMode ? 'ocean' : 'rjv-default'}\r\n                        style={{ padding: 10, borderRadius: 10 }}\r\n                        src={myValue}\r\n                        name={null}\r\n                        enableClipboard={(e) => onClipboardCopy(e)}\r\n                        quotesOnKeys={false}\r\n                        displayDataTypes={false}\r\n                    />\r\n                )}\r\n                {!disabled && (\r\n                    <div key={JSON.stringify(myValue)}>\r\n                        <ReactJson\r\n                            theme={isDarkMode ? 'ocean' : 'rjv-default'}\r\n                            style={{ padding: 10, borderRadius: 10 }}\r\n                            src={myValue}\r\n                            name={null}\r\n                            quotesOnKeys={false}\r\n                            displayDataTypes={false}\r\n                            enableClipboard={(e) => onClipboardCopy(e)}\r\n                            onMouseUp={(event) => {\r\n                                if (inputParam?.acceptVariable) {\r\n                                    setMouseUpKey(event.name)\r\n                                    setAnchorEl(event.currentTarget)\r\n                                }\r\n                            }}\r\n                            onEdit={(edit) => {\r\n                                setMyValue(edit.updated_src)\r\n                                onChange(JSON.stringify(edit.updated_src))\r\n                            }}\r\n                            onAdd={() => {\r\n                                //console.log(add)\r\n                            }}\r\n                            onDelete={(deleteobj) => {\r\n                                setMyValue(deleteobj.updated_src)\r\n                                onChange(JSON.stringify(deleteobj.updated_src))\r\n                            }}\r\n                        />\r\n                    </div>\r\n                )}\r\n            </FormControl>\r\n            {inputParam?.acceptVariable && (\r\n                <Popover\r\n                    open={openPopOver}\r\n                    anchorEl={anchorEl}\r\n                    onClose={handleClosePopOver}\r\n                    anchorOrigin={{\r\n                        vertical: 'bottom',\r\n                        horizontal: 'left'\r\n                    }}\r\n                    transformOrigin={{\r\n                        vertical: 'top',\r\n                        horizontal: 'left'\r\n                    }}\r\n                >\r\n                    <SelectVariable\r\n                        disabled={disabled}\r\n                        availableNodesForVariable={availableNodesForVariable}\r\n                        onSelectAndReturnVal={(val) => {\r\n                            setNewVal(val)\r\n                            handleClosePopOver()\r\n                        }}\r\n                    />\r\n                </Popover>\r\n            )}\r\n        </>\r\n    )\r\n}\r\n\r\nJsonEditorInput.propTypes = {\r\n    value: PropTypes.string,\r\n    onChange: PropTypes.func,\r\n    disabled: PropTypes.bool,\r\n    isDarkMode: PropTypes.bool,\r\n    inputParam: PropTypes.object,\r\n    nodes: PropTypes.array,\r\n    edges: PropTypes.array,\r\n    nodeId: PropTypes.string\r\n}\r\n"],"mappings":"AAAA,OAASA,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAE3C,OAASC,WAAW,CAAEC,OAAO,KAAQ,eAAe,CACpD,MAAO,CAAAC,SAAS,KAAM,yBAAyB,CAC/C,MAAO,CAAAC,cAAc,KAAM,kBAAkB,CAC7C,OAASC,SAAS,KAAQ,QAAQ,CAClC,OAASC,4BAA4B,KAAQ,qBAAqB,QAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,gCAAAC,QAAA,IAAAC,SAAA,yBAElE,MAAO,MAAM,CAAAC,eAAe,CAAGC,IAAA,EAAiG,IAAhG,CAAEC,KAAK,CAAEC,QAAQ,CAAEC,UAAU,CAAEC,KAAK,CAAEC,KAAK,CAAEC,MAAM,CAAEC,QAAQ,CAAG,KAAK,CAAEC,UAAU,CAAG,KAAM,CAAC,CAAAR,IAAA,CACvH,KAAM,CAACS,OAAO,CAAEC,UAAU,CAAC,CAAGxB,QAAQ,CAACe,KAAK,CAAGU,IAAI,CAACC,KAAK,CAACX,KAAK,CAAC,CAAG,CAAC,CAAC,CAAC,CACtE,KAAM,CAACY,yBAAyB,CAAEC,4BAA4B,CAAC,CAAG5B,QAAQ,CAAC,EAAE,CAAC,CAC9E,KAAM,CAAC6B,UAAU,CAAEC,aAAa,CAAC,CAAG9B,QAAQ,CAAC,EAAE,CAAC,CAEhD,KAAM,CAAC+B,QAAQ,CAAEC,WAAW,CAAC,CAAGhC,QAAQ,CAAC,IAAI,CAAC,CAC9C,KAAM,CAAAiC,WAAW,CAAGC,OAAO,CAACH,QAAQ,CAAC,CAErC,KAAM,CAAAI,kBAAkB,CAAGA,CAAA,GAAM,CAC7BH,WAAW,CAAC,IAAI,CAAC,CACrB,CAAC,CAED,KAAM,CAAAI,SAAS,CAAIC,GAAG,EAAK,CACvB,KAAM,CAAAC,MAAM,CAAGjC,SAAS,CAACkB,OAAO,CAAC,CACjCe,MAAM,CAACT,UAAU,CAAC,CAAGQ,GAAG,CACxBrB,QAAQ,CAACS,IAAI,CAACc,SAAS,CAACD,MAAM,CAAC,CAAC,CAChCd,UAAU,CAAEgB,MAAM,GAAM,CACpB,GAAGA,MAAM,CACT,CAACX,UAAU,EAAGQ,GAClB,CAAC,CAAC,CAAC,CACP,CAAC,CAED,KAAM,CAAAI,eAAe,CAAIC,CAAC,EAAK,CAC3B,KAAM,CAAAC,GAAG,CAAGD,CAAC,CAACC,GAAG,CACjB,GAAIC,KAAK,CAACC,OAAO,CAACF,GAAG,CAAC,EAAI,MAAO,CAAAA,GAAG,GAAK,QAAQ,CAAE,CAC/CG,SAAS,CAACC,SAAS,CAACC,SAAS,CAACvB,IAAI,CAACc,SAAS,CAACI,GAAG,CAAE,IAAI,CAAE,IAAI,CAAC,CAAC,CAClE,CAAC,IAAM,CACHG,SAAS,CAACC,SAAS,CAACC,SAAS,CAACL,GAAG,CAAC,CACtC,CACJ,CAAC,CAED5C,SAAS,CAAC,IAAM,CACZ,GAAI,CAACsB,QAAQ,EAAIH,KAAK,EAAIC,KAAK,EAAIC,MAAM,EAAIH,UAAU,CAAE,CACrD,KAAM,CAAAgC,gBAAgB,CAAGhC,UAAU,SAAVA,UAAU,WAAVA,UAAU,CAAEiC,cAAc,CAAG5C,4BAA4B,CAACY,KAAK,CAAEC,KAAK,CAAEC,MAAM,CAAEH,UAAU,CAACkC,EAAE,CAAC,CAAG,EAAE,CAC5HvB,4BAA4B,CAACqB,gBAAgB,CAAC,CAClD,CACJ,CAAC,CAAE,CAAC5B,QAAQ,CAAEJ,UAAU,CAAEC,KAAK,CAAEC,KAAK,CAAEC,MAAM,CAAC,CAAC,CAEhD,mBACIV,KAAA,CAAAE,SAAA,EAAAwC,QAAA,eACI1C,KAAA,CAACT,WAAW,EAACoD,EAAE,CAAE,CAAEC,EAAE,CAAE,CAAC,CAAEC,KAAK,CAAE,MAAO,CAAE,CAACC,IAAI,CAAC,OAAO,CAAAJ,QAAA,EAClD/B,QAAQ,eACLb,IAAA,CAACL,SAAS,EACNsD,KAAK,CAAEnC,UAAU,CAAG,OAAO,CAAG,aAAc,CAC5CoC,KAAK,CAAE,CAAEC,OAAO,CAAE,EAAE,CAAEC,YAAY,CAAE,EAAG,CAAE,CACzCjB,GAAG,CAAEpB,OAAQ,CACbsC,IAAI,CAAE,IAAK,CACXC,eAAe,CAAGpB,CAAC,EAAKD,eAAe,CAACC,CAAC,CAAE,CAC3CqB,YAAY,CAAE,KAAM,CACpBC,gBAAgB,CAAE,KAAM,CAC3B,CACJ,CACA,CAAC3C,QAAQ,eACNb,IAAA,QAAA4C,QAAA,cACI5C,IAAA,CAACL,SAAS,EACNsD,KAAK,CAAEnC,UAAU,CAAG,OAAO,CAAG,aAAc,CAC5CoC,KAAK,CAAE,CAAEC,OAAO,CAAE,EAAE,CAAEC,YAAY,CAAE,EAAG,CAAE,CACzCjB,GAAG,CAAEpB,OAAQ,CACbsC,IAAI,CAAE,IAAK,CACXE,YAAY,CAAE,KAAM,CACpBC,gBAAgB,CAAE,KAAM,CACxBF,eAAe,CAAGpB,CAAC,EAAKD,eAAe,CAACC,CAAC,CAAE,CAC3CuB,SAAS,CAAGC,KAAK,EAAK,CAClB,GAAIjD,UAAU,SAAVA,UAAU,WAAVA,UAAU,CAAEiC,cAAc,CAAE,CAC5BpB,aAAa,CAACoC,KAAK,CAACL,IAAI,CAAC,CACzB7B,WAAW,CAACkC,KAAK,CAACC,aAAa,CAAC,CACpC,CACJ,CAAE,CACFC,MAAM,CAAGC,IAAI,EAAK,CACd7C,UAAU,CAAC6C,IAAI,CAACC,WAAW,CAAC,CAC5BtD,QAAQ,CAACS,IAAI,CAACc,SAAS,CAAC8B,IAAI,CAACC,WAAW,CAAC,CAAC,CAC9C,CAAE,CACFC,KAAK,CAAEA,CAAA,GAAM,CACT;AAAA,CACF,CACFC,QAAQ,CAAGC,SAAS,EAAK,CACrBjD,UAAU,CAACiD,SAAS,CAACH,WAAW,CAAC,CACjCtD,QAAQ,CAACS,IAAI,CAACc,SAAS,CAACkC,SAAS,CAACH,WAAW,CAAC,CAAC,CACnD,CAAE,CACL,CAAC,EA1BI7C,IAAI,CAACc,SAAS,CAAChB,OAAO,CA2B3B,CACR,EACQ,CAAC,CACb,CAAAN,UAAU,SAAVA,UAAU,iBAAVA,UAAU,CAAEiC,cAAc,gBACvB1C,IAAA,CAACN,OAAO,EACJwE,IAAI,CAAEzC,WAAY,CAClBF,QAAQ,CAAEA,QAAS,CACnB4C,OAAO,CAAExC,kBAAmB,CAC5ByC,YAAY,CAAE,CACVC,QAAQ,CAAE,QAAQ,CAClBC,UAAU,CAAE,MAChB,CAAE,CACFC,eAAe,CAAE,CACbF,QAAQ,CAAE,KAAK,CACfC,UAAU,CAAE,MAChB,CAAE,CAAA1B,QAAA,cAEF5C,IAAA,CAACJ,cAAc,EACXiB,QAAQ,CAAEA,QAAS,CACnBM,yBAAyB,CAAEA,yBAA0B,CACrDqD,oBAAoB,CAAG3C,GAAG,EAAK,CAC3BD,SAAS,CAACC,GAAG,CAAC,CACdF,kBAAkB,CAAC,CAAC,CACxB,CAAE,CACL,CAAC,CACG,CACZ,EACH,CAAC,CAEX,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}